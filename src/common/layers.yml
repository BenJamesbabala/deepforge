# This file should actually be an alternative way of viewing the metamodel. 
#
# This contains metadata about the Torch nn library used for
# creating the metamodel
#
# By default...
#   - all attributes are a number
#   - default values are optional
#       - all booleans default to false
#   - list attributes are specified with WORD...WORD
#   - if `ignore` is set, the attribute is not added to the metamodel

# This should have tests to verify that this document is up to date...
# TODO

# TODO: Add the following layers
#VolumetricMaxUnpooling
#ConcatTable
#Jacobian
#SpatialCrossMapLRN
#CAddTable
#TanhShrink
#MixtureTable
#SpatialConvolutionLocal
#BatchNormalization
#MulConstant
#NarrowTable
#SplitTable
#DotProduct
#SpatialBatchNormalization
#DepthConcat
#CMulTable
#Parallel
#Log
#SpatialDropout
#hessian
#ELU
#CSubTable
#VolumetricAveragePooling
#StochasticGradient
#SpatialContrastiveNormalization
#Bilinear
#Padding
#Container
#VolumetricFullConvolution
#Concat
#SparseJacobian
#Contiguous
#L1Cost
#JoinTable
#CosineDistance
#Index
#SpatialDivisiveNormalization
#L1Penalty
#Sequential
#Cosine
#Clamp
#SpatialConvolutionMM
#LogSigmoid
#Threshold
#ParallelTable
#CDivTable
#SpatialFullConvolutionMap
#GradientReversal
#SpatialMaxUnpooling
#Transpose
#SpatialFullConvolution
#FlattenTable
#Normalize
#SpatialSoftMax
#SelectTable
#SpatialFractionalMaxPooling

ConvLayer:
    - TemporalConvolution:
        - inputFrameSize:
            min: 1
        - outputFrameSize:
            min: 1
        - kernelWidth:
            min: 1
        - step:
            default: 1

    - TemporalMaxPooling:
        - kernelWidth:
            min: 1
        - step:
            min: 1
            # TODO: What is the default?

    - TemporalSubSampling:
        - inputFrameSize:
            min: 1
        - kernelWidth:
            min: 1
        - step:
            min: 1
            # TODO: What is the default?

    - LookupTable:
        - nIndex:
            min: 1
            # TODO: What is the default?
        - sizes:
            min: 1

# Spatial Modules
    - SpatialConvolution:
        - nInputPlane:
            min: 1
        - nOutputPlane:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialConvolutionMap:
        - connectionMatrix:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialLPPooling:
        - nInputPlane:
            min: 1
        - norm:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialMaxPooling:
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialAveragePooling:
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialAdaptiveMaxPooling:  # output is width x height
        - width:
            min: 1
        - height:
            min: 1

    - SpatialSubSampling:
        - nInputPlane:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideWidth:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1

    - SpatialUpSamplingNearest:
        - scale:  # upscale ratio
            min: 1

    - SpatialZeroPadding:
        - left:
            min: 0
        - right:
            min: 0
        - top:
            min: 0
        - bottom:
            min: 0

    - SpatialSubtractiveNormalization:
        - nInputPlane:
            min: 1
        - kernel:
            min: 1

# Volumetric Modules
    - VolumetricConvolution:
        - nInputPlane:
            min: 1
        - nOutputPlane:
            min: 1
        - kernelTime:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideTime:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1
        - strideHeight:
            min: 1
            default: 1
    - VolumetricMaxPooling:
        - kernelTime:
            min: 1
        - kernelWidth:
            min: 1
        - kernelHeight:
            min: 1
        - strideTime:
            min: 1
            default: 1
        - strideWidth:
            min: 1
            default: 1
        - strideHeight:
            min: 1
            default: 1

SimpleLayer:
    - Linear:  # FIXME: These should contain the actual args
        - input:
            ignore: true
        - output:
            min: 1
    - SparseLinear: 
        - input: 
            ignore: true
        - output:
            min: 1

    - Dropout: 
        - probability:
            type: float
    - Abs:
    - Add:
        - isScalar:
            type: boolean
    - Mul:
    - CMul:
        - size: null
    - Max:
        - dimension:
            min: 0
    - Min:
        - dimension:
            min: 0
    - Mean:
        - dimension:
            min: 0
    - Sum:
        - dimension:
            min: 0

    - Euclidean:
        - output:
            min: 0
    - WeightedEuclidean:
        - output:
            min: 0
    - Identity:
    - Copy:  # Casts types
        - inputType:
            type: string
        - outputType:
            type: string
        - forceCopy:
            type: boolean
    - Narrow:
        - dimension:
            min: 0
        - offset:
            min: 0
        - length:
            min: 0
    - Replicate:
        - nFeature:
            min: 0
    - Reshape:
        - dimensions:
            type: list
    - View:
        - sizes:
            min: 0
    - Select:
        - dimensions:
            type: list
    - Exp
    - Square
    - Sqrt
    - Power:
        - p: null
    - MM:
        - transA:
            type: boolean
        - transB:
            type: boolean

TransferLayer:
    - HardTanh
    - HardShrink:
        - lambda:
            type: float
    - SoftShrink:
        - lambda:
            type: float
    - SoftMax
    - SoftMin
    - SoftPlus
    - SoftSign  # Typo in the docs on this one
    - LogSigmoid
    - LogSoftMax  # Also in Criterion?
    - Sigmoid
    - Tanh
    - ReLU
    - PReLU  # Missing from docs
    - RReLU  # Missing from docs
    - LeakyReLU  # Missing from docs
    - AddConstant:
        - scalar:
            type: float
    - MulConstant:
        - scalar:
            type: float

Criterion:
    - BCECriterion
    - WeightedMSECriterion
    - SmoothL1Criterion
    - MSECriterion
    - AbsCriterion
    - MultiCriterion
    - DistKLDivCriterion
    - HingeEmbeddingCriterion
    - CriterionTable
    - MultiMarginCriterion
    - MultiLabelMarginCriterion
    - L1HingeEmbeddingCriterion
    - CosineEmbeddingCriterion
    - MarginRankingCriterion
    - CrossEntropyCriterion
    - MarginCriterion
    - ClassNLLCriterion
    - ParallelCriterion

# CONTAINERS and TableLayouts
# Some of these are captured by the visual structure of the architecture and are not needed
# as explicit layers in the metamodel
#TableLayer:
#- ConcatTable
#Container:

